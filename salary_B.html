<!DOCTYPE html>
<html lang="tw">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="">
  <meta name="author" content="">

  <title>悅盛保全 - 櫃台服務系統</title>

  <!-- Bootstrap core CSS -->
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="/css/bootstrap-theme.min.css" >

  <script src="/js/jquery.js"></script>
  <!-- Latest compiled and minified JavaScript -->
  <script src="/js/bootstrap.min.js" ></script>
  <script src="/js/vue.js"></script>
  <link rel="stylesheet" href="/css/main.css">
  <script type="text/javascript" src="/js/Common.js"></script>
</head>

<body>
  <div class="loadingMask" style="width:100%;height:100%;position:fixed;background: rgba(0,0,0,0.3);z-index:1111;display: none"></div>
  <header>
    <nav class="navbar">

    </nav>
  </header>


  <!-- Main jumbotron for a primary marketing message or call to action -->
  <div class="jumbotron">
    <div class="container" id="query">
      年月 :
      <select class="YM"></select>
      <a class="btn btn-default" id="scanEmp" href="#" role="button">查詢拆分薪資</a>
      <span style="color:red;" class="dataIsNull"></span>
    </div>
    <div class="container">
      <div id="salary" class="panel panel-warning" style="display:none">
        <h3>{{peps.detail.F_EMP_NAME}}
          <span id="YMshow"></span>拆分薪資明細表</h3>
        <table class="table">
          <tr>
            <th colspan="2" scope="col">應得項目</th>
            <th colspan="2" scope="col">應扣項目</th>
            <th colspan="2" scope="col">其他項目</th>
          </tr>
          <tr>
            <td>{{peps.item.F_P0.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_P0}}</td>
            <td>{{peps.item.F_M0.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_M0}}</td>
            <td>{{peps.item.F_P6.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_P6}}</td>
          </tr>
          <tr>
            <td>{{peps.item.F_P1.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_P1}}</td>
            <td>{{peps.item.F_M1.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_M1}}</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>{{peps.item.F_P2.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_P2}}</td>
            <td>{{peps.item.F_M2.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_M2}}</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>{{peps.item.F_P3.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_P3}}</td>
            <td>{{peps.item.F_M3.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_M3}}</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>{{peps.item.F_P4.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_P4}}</td>
            <td>{{peps.item.F_M4.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_M4}}</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>{{peps.item.F_P5.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_P5}}</td>
            <td>{{peps.item.F_M5.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_M5}}</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td>{{peps.item.F_M6.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_M6}}</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>{{peps.item.F_P7.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_P7}}</td>
            <td>{{peps.item.F_M7.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_M7}}</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>{{peps.item.F_P8.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_P8}}</td>
            <td>{{peps.item.F_M8.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_M8}}</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>{{peps.item.F_P9.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_P9}}</td>
            <td>{{peps.item.F_M9.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_M9}}</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>{{peps.item.F_PA.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_PA}}</td>
            <td>{{peps.item.F_MA.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_MA}}</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>{{peps.item.F_PB.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_PB}}</td>
            <td>{{peps.item.F_MB.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_MB}}</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>{{peps.item.F_PC.F_ITEM_NAME}}</td>
            <td>{{peps.detail.F_PC}}</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </table>
        <h3>實領所得:{{peps.detail.F_TT}}</h3>
      </div>
    </div>
  </div>

  <div class="container">
    <footer>
      <p>&copy; 2016 悅盛保全, Inc.</p>
    </footer>
  </div>
  <!-- /container -->
  <script type="text/javascript">
    var vm;
    //var navJade = jade.compileFile("views/nav.jade");
    const scan = require("./js/scan.js");
    const request = require("request");
    var classList = $(".classList");
    var classHtml;
    var scanEmp = $("#scanEmp");
    let targerUrl = config.ajaxOrder;
    //測試
    //  targerUrl = config.testURL;
    $(document).ready(function () {
      var loading = $("#loading");
      var loadingMask = $(".loadingMask");
      var salary = $("#salary");
      const loadSalary = function (ym) {
        loadingMask.css("display", "block");
        loading.removeClass("rotateOut");
        loading.css("display", "block");
        loading.addClass("rotateIn");
        salary.hide();
        scan(empId => {
          
          // 測試
          // empId = 'T10011';

          var result = $.ajax({
              type: `post`,
              url: targerUrl,
              data: {
                Order: `Get_personalSalary`,
                F_YM: ym,
                F_EMP_ID: empId,
                Type: 'B'
              },
              async: false,
              dataType: `json`
            });
            
              let salaryObj = result.responseJSON;
              if (salaryObj.detail.length != 0) {
                salary.show();
                pushDom(salaryObj);
              } 
              else {
                $(".dataIsNull").text("資料查詢為空");
              }
              loadingMask.css("display", "none");
              loading.css("display", "none");
              loading.removeClass("rotateIn");
              loading.addClass("rotateOut");
              console.log("done");
        });
      };

      function pushDom(data1) {
        vm = new Vue({
          el: '#salary',
          data: {
            peps: data1
          }
        });
      }
      selectYm = $(".YM");
      var d = new Date();
      var d1 = new Date(d.getFullYear(),d.getMonth(),0);
      var d1Ym = d1.getFullYear() + "-" + ("0" + (d1.getMonth() + 1)).slice(-2);
      var d2 = new Date(d1.getFullYear(),d1.getMonth(),0);
      var d2Ym = d2.getFullYear() + "-" + ("0" + (d2.getMonth() + 1)).slice(-2);
      var d3 = new Date(d2.getFullYear(),d2.getMonth(),0);
      var d3Ym = d3.getFullYear() + "-" + ("0" + (d3.getMonth() + 1)).slice(-2);
      selectYm.append("<option selected='selected' value='"+d1Ym+"'>"+d1Ym+"</option>");
      selectYm.append("<option value='"+d2Ym+"'>"+d2Ym+"</option>");
      selectYm.append("<option value='"+d3Ym+"'>"+d3Ym+"</option>");
      scanEmp.click(function () {
        let ym = selectYm.val();
        console.log(ym);
        loadSalary(ym);
      });
    });
  </script>
  <button class="btn btn-lg btn-warning" id="loading" style="display:none;">
    <span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span>請在20秒內掃描員工識別證</button>
</body>

</html>
